"""
a.	Create a new Python file (e.g., lab1_ex2.py) and write a script that uses the adafruit_dht module to read temperature and humidity from the DHT-11 sensor. 

b.	Every 2 seconds, print the T/H values using the following format:
year-month-day hour:minute:second.microseconds - mac_address:temperature = T
year-month-day hour:minute:second.microseconds - mac_address:humidity = H

where mac_address is the MAC address of your network card, 
T is the temperature value in degree Celsius, 
and H is the humidity value in %RH.

Example:
2022-10-01 19:21:51.699254 - 0xf0b61e0bfe09:temperature = 21
2022-10-01 19:21:51.699254 - 0xf0b61e0bfe09:humidity = 60
2022-10-01 19:21:53.701326 - 0xf0b61e0bfe09:temperature = 22
2022-10-01 19:21:53.701326 - 0xf0b61e0bfe09:humidity = 59
"""


import adafruit_dht #mi serve per leggere i sensori DHT
import uuid #per ottenere il MAC address della scheda di rete.
import time 
from datetime import datetime #questa e sopra per timestamp e formattazione data/ora.
from board import D4 #pin fisico della libreria board che mappa al GPIO4 del Raspberry.

mac_address = hex(uuid.getnode()) #Prende il MAC come intero e lo converte in esadecimale (es. 0xf0b61e0bfe09), come da esempio.
dht_device = adafruit_dht.DHT11(D4) #Crea lâ€™oggetto sensore collegato al pin D4 (GPIO4) 
                                    #e Assicurati che il pin dati del DHT11 sia su GPIO4 (e resistenza di pull-up 10k tra VCC e DATA).

while True: #legge e stampa continuamente
    timestamp = time.time()
    formatted_datetime = datetime.fromtimestamp(timestamp).strftime('%Y-%m-%d %H:%M:%S.%f') #prende ora locale e la stampa come rihciesto
    try:
        temperature = dht_device.temperature
        humidity = dht_device.humidity

        print(f'{formatted_datetime} - {mac_address}:temperature = {temperature}')
        print(f'{formatted_datetime} - {mac_address}:humidity = {humidity}')
    except:
        print(f'{formatted_datetime} - sensor failure')
        dht_device.exit()
        dht_device = adafruit_dht.DHT11(D4)

    
    time.sleep(2) #fai una pausa ogni -tot- secondi